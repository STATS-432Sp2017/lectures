---
title: "Graphics"
author: "DJM"
date: "11 April 2017"
output:
  slidy_presentation: default
  pdf_document: default
  beamer_presentation: default
---





## Generalized linear models


```{r setup, message=FALSE, echo=FALSE}
# Need the knitr package to set chunk options
library(knitr)
library(tidyverse)
# Set knitr options for knitting code into the report:
# - Don't print out code (echo)
# - Save results so that code blocks aren't re-run unless code changes (cache),
# _or_ a relevant earlier code block changed (autodep), but don't re-run if the
# only thing that changed was the comments (cache.comments)
# - Don't clutter R output with messages or warnings (message, warning)
  # This _will_ leave error messages showing up in the knitted report
opts_chunk$set(message=FALSE, warning=FALSE, fig.align='center',fig.width=8,
               fig.height=4,cache=TRUE,autodep=TRUE)
```

> "The simple graph has brought more information to the data analystâ€™s mind 
> than any other device." --- John Tukey

* This week we're going to learn how to use `ggplot2`, Hadley Wickham's package for making graphics.

* This material is based on Chapter 3 of his book "`R` for data science".

* That is your reading for this week (link on syllabus page).


## Why ggplot?

* `ggplot2` is a bit hard to get used to.

* But it's figures are much better looking than `R`'s `plot` functions.

* Compare:

```{r plot-ex-data, echo=FALSE}
nums = rbinom(250,2,.66)+1
classes = LETTERS[nums]
vals = rnorm(250, nums, 1/nums)
df = data.frame(classes, vals)
```

```{r plots}
boxplot(vals~classes, data=df)
ggplot(df,mapping=aes(x=classes,y=vals,fill=classes)) + geom_boxplot()
```

## Graphics are for addressing questions

* Do cars with big engines use more fuel than cars with small engines? 

* You probably already have an answer, but try to make your answer precise. 

* What does the relationship between engine size and fuel efficiency look like? 

* Is it positive? Negative? Linear? Nonlinear?


## Some data

```{r}
mpg
```

Among the variables in `mpg` are:

1. `displ`, a car's engine size, in litres.

1. `hwy`, a car's fuel efficiency on the highway, in miles per gallon (mpg). 
  A car with a low fuel efficiency consumes more fuel than a car with a high 
  fuel efficiency when they travel the same distance. 
  
## First plot

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy))
```

* `ggplot()` creates a coordinate system. 

* The first argument of `ggplot()` is the dataset to use in the graph. So `ggplot(data = mpg)` creates an empty graph, but it's not very interesting.

* `geom_point()` adds a layer of points to your plot.

* Each geom function in ggplot2 takes a `mapping` argument. 

* This defines how variables in your dataset are mapped to visual properties. 

* The `mapping` argument is always paired with `aes()`, and the `x` and `y` arguments of `aes()` specify which variables to map to the x and y axes. 

* ggplot2 looks for the mapped variable in the `data` argument, in this case, `mpg`.

## Again...

Note:

```{r}
ggplot(mpg) + geom_point(aes(displ,hwy))
```

In general:

```
ggplot(data = <DATA>) + 
  <GEOM_FUNCTION>(mapping = aes(<MAPPINGS>))
```

## Aesthetics

> "The greatest value of a picture is when it forces us to notice what we
> never expected to see." --- John Tukey

```{r, echo = FALSE}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) +
  geom_point() + 
  geom_point(data = dplyr::filter(mpg, displ > 5, hwy > 20), colour = "red", size = 2.2)
```

* The red points seem to be outliers.

## Coloring

* Perhaps another variable explains them (say, hybrid SUVs)

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, color = class))
```


## Size

```{r, warning=TRUE}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, size = class))
```

## Transparency and shape

```{r out.width = "50%", fig.align = 'default', warning = FALSE, fig.asp = 1/2, fig.cap ="",fig.show='hold',warning=TRUE}
# Left
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, alpha = class))

# Right
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, shape = class))
```

## Just like some color

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy), color = "#31B404")
```

## Facets

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) + 
  facet_wrap(~ class, nrow = 2)
```


```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) + 
  facet_grid(drv ~ cyl)
```

## Rows or columns

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) +
  facet_grid(drv ~ .)
    
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) +
  facet_grid(. ~ cyl)
```

## What are geoms?

```{r, out.width = "50%", fig.align="default", fig.show='hold', message = FALSE}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy))

ggplot(data = mpg) + 
  geom_smooth(mapping = aes(x = displ, y = hwy))
```

* Different __geoms__ lead to different kinds of geometric objects.

* bar charts use bar geoms, 

* line charts use line geoms, 

* boxplots use boxplot geoms

* Scatterplots break the trend; they use the point geom.

## Line types

```{r message = FALSE}
ggplot(data = mpg) + 
  geom_smooth(mapping = aes(x = displ, y = hwy, linetype = drv))
```

* One line describes all of the points with a `4` value, 

* one line describes all of the points with an `f` value, 

* and one line describes all of the points with an `r` value.

## More clear

```{r, echo=FALSE, message = FALSE}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = drv)) + 
  geom_point() +
  geom_smooth(mapping = aes(linetype = drv))
```


## Grouping

* Many geoms use a single geometric object to display multiple rows of data. 

* you can set the `group` aesthetic to a categorical variable to draw multiple objects. 

* ggplot2 will draw a separate object for each unique value of the grouping variable. 

* the `group` aesthetic by itself does not add a legend or distinguishing features to the geoms (`linetype` or `color` do).

```{r, fig.align = 'default', out.width = "50%", fig.show='hold',message = FALSE}
ggplot(data = mpg) +
  geom_smooth(mapping = aes(x = displ, y = hwy))
              
ggplot(data = mpg) +
  geom_smooth(mapping = aes(x = displ, y = hwy, group = drv))
```

## Multiple geoms

* To display multiple geoms in the same plot, add multiple geom functions to `ggplot()`:

```{r, message = FALSE}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) +
  geom_smooth(mapping = aes(x = displ, y = hwy))
```

* Creates duplication, annoying to type `aes(x = displ, y = hwy)`.

```{r, eval = FALSE}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_point() + 
  geom_smooth()
```

* mappings in `ggplot` are _global_, in a geom, they are _local_ to the geom.

## Ex

```{r, message = FALSE}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_point(mapping = aes(color = class)) + 
  geom_smooth()
```

```{r, message = FALSE}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_point(mapping = aes(color = class)) + 
  geom_smooth(data = filter(mpg, class == "subcompact"), se = FALSE)
```